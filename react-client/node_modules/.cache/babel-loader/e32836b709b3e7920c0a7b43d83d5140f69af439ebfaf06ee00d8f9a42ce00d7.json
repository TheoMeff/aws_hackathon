{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useRef } from 'react';\nimport { ComponentMetrics, PerformanceMetrics } from '../../analytics';\nimport { useFunnel } from '../../analytics/hooks/use-funnel';\nimport { useDebounceCallback } from '../use-debounce-callback';\nimport { useDOMAttribute } from '../use-dom-attribute';\nimport { useEffectOnUpdate } from '../use-effect-on-update';\nimport { useRandomId } from '../use-unique-id';\n/*\nIf the last user interaction is more than this time ago, it is not considered\nto be the cause of the current loading state.\n*/\nconst USER_ACTION_TIME_LIMIT = 1000;\nexport function useTableInteractionMetrics({\n  elementRef,\n  items,\n  itemCount,\n  instanceIdentifier,\n  getComponentIdentifier,\n  getComponentConfiguration,\n  loading = false,\n  interactionMetadata\n}) {\n  const taskInteractionId = useRandomId();\n  const tableInteractionAttributes = useDOMAttribute(elementRef, 'data-analytics-task-interaction-id', taskInteractionId);\n  const {\n    isInFunnel\n  } = useFunnel();\n  const lastUserAction = useRef(null);\n  const capturedUserAction = useRef(null);\n  const loadingStartTime = useRef(null);\n  const metadata = useRef({\n    itemCount,\n    getComponentIdentifier,\n    getComponentConfiguration,\n    interactionMetadata\n  });\n  metadata.current = {\n    itemCount,\n    getComponentIdentifier,\n    getComponentConfiguration,\n    interactionMetadata\n  };\n  useEffect(() => {\n    if (isInFunnel) {\n      return;\n    }\n    ComponentMetrics.componentMounted({\n      taskInteractionId,\n      componentName: 'table',\n      componentConfiguration: metadata.current.getComponentConfiguration()\n    });\n  }, [taskInteractionId, isInFunnel]);\n  useEffect(() => {\n    if (loading) {\n      loadingStartTime.current = performance.now();\n      if (lastUserAction.current && lastUserAction.current.time > performance.now() - USER_ACTION_TIME_LIMIT) {\n        capturedUserAction.current = lastUserAction.current.name;\n      } else {\n        capturedUserAction.current = null;\n      }\n    }\n  }, [loading]);\n  useEffectOnUpdate(() => {\n    var _a;\n    if (!loading && loadingStartTime.current !== null) {\n      const loadingDuration = performance.now() - loadingStartTime.current;\n      loadingStartTime.current = null;\n      PerformanceMetrics.tableInteraction({\n        userAction: (_a = capturedUserAction.current) !== null && _a !== void 0 ? _a : '',\n        interactionTime: Math.round(loadingDuration),\n        interactionMetadata: metadata.current.interactionMetadata(),\n        componentIdentifier: metadata.current.getComponentIdentifier(),\n        instanceIdentifier,\n        noOfResourcesInTable: metadata.current.itemCount\n      });\n    }\n  }, [instanceIdentifier, loading, taskInteractionId, isInFunnel]);\n  const debouncedUpdated = useDebounceCallback(() => {\n    var _a, _b;\n    ComponentMetrics.componentUpdated({\n      taskInteractionId,\n      componentName: 'table',\n      actionType: (_b = (_a = lastUserAction.current) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : '',\n      componentConfiguration: metadata.current.getComponentConfiguration()\n    });\n  });\n  useEffectOnUpdate(() => {\n    if (isInFunnel || loading) {\n      return;\n    }\n    debouncedUpdated();\n    // Note: items used as a dependency here to trigger updates as a side effect\n  }, [taskInteractionId, isInFunnel, loading, items, debouncedUpdated]);\n  return {\n    tableInteractionAttributes,\n    setLastUserAction: name => void (lastUserAction.current = {\n      name,\n      time: performance.now()\n    })\n  };\n}","map":{"version":3,"names":["useEffect","useRef","ComponentMetrics","PerformanceMetrics","useFunnel","useDebounceCallback","useDOMAttribute","useEffectOnUpdate","useRandomId","USER_ACTION_TIME_LIMIT","useTableInteractionMetrics","elementRef","items","itemCount","instanceIdentifier","getComponentIdentifier","getComponentConfiguration","loading","interactionMetadata","taskInteractionId","tableInteractionAttributes","isInFunnel","lastUserAction","capturedUserAction","loadingStartTime","metadata","current","componentMounted","componentName","componentConfiguration","performance","now","time","name","loadingDuration","tableInteraction","userAction","_a","interactionTime","Math","round","componentIdentifier","noOfResourcesInTable","debouncedUpdated","componentUpdated","actionType","_b","setLastUserAction"],"sources":["/Users/theo/Library/CloudStorage/OneDrive-RackspaceInc/Documents/aws_hackathon/react-client/node_modules/src/internal/hooks/use-table-interaction-metrics/index.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { useEffect, useRef } from 'react';\n\nimport { ComponentMetrics, PerformanceMetrics } from '../../analytics';\nimport { useFunnel } from '../../analytics/hooks/use-funnel';\nimport { JSONObject } from '../../analytics/interfaces';\nimport { useDebounceCallback } from '../use-debounce-callback';\nimport { useDOMAttribute } from '../use-dom-attribute';\nimport { useEffectOnUpdate } from '../use-effect-on-update';\nimport { useRandomId } from '../use-unique-id';\n\n/*\nIf the last user interaction is more than this time ago, it is not considered\nto be the cause of the current loading state.\n*/\nconst USER_ACTION_TIME_LIMIT = 1_000;\n\nexport interface UseTableInteractionMetricsProps<T> {\n  elementRef: React.RefObject<HTMLElement>;\n  instanceIdentifier: string | undefined;\n  loading: boolean | undefined;\n  items: readonly T[];\n  itemCount: number;\n  getComponentIdentifier: () => string | undefined;\n  getComponentConfiguration: () => JSONObject;\n  interactionMetadata: () => string;\n}\n\nexport function useTableInteractionMetrics<T>({\n  elementRef,\n  items,\n  itemCount,\n  instanceIdentifier,\n  getComponentIdentifier,\n  getComponentConfiguration,\n  loading = false,\n  interactionMetadata,\n}: UseTableInteractionMetricsProps<T>) {\n  const taskInteractionId = useRandomId();\n  const tableInteractionAttributes = useDOMAttribute(\n    elementRef,\n    'data-analytics-task-interaction-id',\n    taskInteractionId\n  );\n  const { isInFunnel } = useFunnel();\n  const lastUserAction = useRef<{ name: string; time: number } | null>(null);\n  const capturedUserAction = useRef<string | null>(null);\n  const loadingStartTime = useRef<number | null>(null);\n\n  const metadata = useRef({ itemCount, getComponentIdentifier, getComponentConfiguration, interactionMetadata });\n  metadata.current = { itemCount, getComponentIdentifier, getComponentConfiguration, interactionMetadata };\n\n  useEffect(() => {\n    if (isInFunnel) {\n      return;\n    }\n\n    ComponentMetrics.componentMounted({\n      taskInteractionId,\n      componentName: 'table',\n      componentConfiguration: metadata.current.getComponentConfiguration(),\n    });\n  }, [taskInteractionId, isInFunnel]);\n\n  useEffect(() => {\n    if (loading) {\n      loadingStartTime.current = performance.now();\n\n      if (lastUserAction.current && lastUserAction.current.time > performance.now() - USER_ACTION_TIME_LIMIT) {\n        capturedUserAction.current = lastUserAction.current.name;\n      } else {\n        capturedUserAction.current = null;\n      }\n    }\n  }, [loading]);\n\n  useEffectOnUpdate(() => {\n    if (!loading && loadingStartTime.current !== null) {\n      const loadingDuration = performance.now() - loadingStartTime.current;\n      loadingStartTime.current = null;\n\n      PerformanceMetrics.tableInteraction({\n        userAction: capturedUserAction.current ?? '',\n        interactionTime: Math.round(loadingDuration),\n        interactionMetadata: metadata.current.interactionMetadata(),\n        componentIdentifier: metadata.current.getComponentIdentifier(),\n        instanceIdentifier,\n        noOfResourcesInTable: metadata.current.itemCount,\n      });\n    }\n  }, [instanceIdentifier, loading, taskInteractionId, isInFunnel]);\n\n  const debouncedUpdated = useDebounceCallback(() => {\n    ComponentMetrics.componentUpdated({\n      taskInteractionId,\n      componentName: 'table',\n      actionType: lastUserAction.current?.name ?? '',\n      componentConfiguration: metadata.current.getComponentConfiguration(),\n    });\n  });\n\n  useEffectOnUpdate(() => {\n    if (isInFunnel || loading) {\n      return;\n    }\n\n    debouncedUpdated();\n    // Note: items used as a dependency here to trigger updates as a side effect\n  }, [taskInteractionId, isInFunnel, loading, items, debouncedUpdated]);\n\n  return {\n    tableInteractionAttributes,\n    setLastUserAction: (name: string) => void (lastUserAction.current = { name, time: performance.now() }),\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}